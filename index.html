<!doctype html>
<html>

<head>
	<title>KAGE engine sample</title>
	<style>
		#canvas,
		#svg {
			display: inline-block;
			border: 1px #ccc solid;
		}

		svg {
			display: block;
		}

		#inputcontrols > div {
			display: inline-block;
			vertical-align: top;
		}

		#data_area {
			width: 30em;
			height: 32em;
		}
	</style>

	<!-- include the library -->
	<script type="text/javascript" src="./dist/kage.js"></script>

	<script type="text/javascript">
		function updateGlyph() {

			var kage = new Kage();

			kage.kShotai = Number(document.getElementById("inputcontrols").elements["kagefont"].value);
			var paramnames = ["kMinWidthY", "kMinWidthU", "kMinWidthT", "kWidth", "kKakato", "kL2RDfatten", "kMage"];
			var i, paramname;
			for (i = 0; i < paramnames.length; i++) {
				paramname = paramnames[i];
				kage.kFont[paramname] = Number(document.getElementById("kageparam_" + paramname).value);
			}

			var polygons = new Kage.Polygons();

			// ... or specify data and generate glyph into `polygons`
			var dataArea = document.getElementById("data_area");
			kage.makeGlyph2(polygons, dataArea.value.split("\n").join("$"));

			// Draw the result polygons using canvas
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			ctx.fillStyle = "rgb(0, 0, 0)";

			for (i = 0; i < polygons.array.length; i++) {
				ctx.beginPath();
				ctx.moveTo(polygons.array[i].array[0].x, polygons.array[i].array[0].y);
				for (var j = 1; j < polygons.array[i].array.length; j++) {
					ctx.lineTo(polygons.array[i].array[j].x, polygons.array[i].array[j].y);
				}
				ctx.closePath();
				ctx.fill();
			}

			// Get a SVG string for the result polygons
			document.getElementById("svg").innerHTML = polygons.generateSVG(false);
		}

		document.addEventListener("DOMContentLoaded", function () {
			document.getElementById("inputcontrols").addEventListener("input", updateGlyph);
			document.getElementById("inputcontrols").addEventListener("submit", function (evt) {
				evt.preventDefault();
			});

			var dataArea = document.getElementById("data_area");
			var m = location.hash.match(/^#kage=([^&]+)/);
			if (m) {
				dataArea.value = decodeURIComponent(m[1]).split("$").join("\n");
			}
			updateGlyph();
		});
	</script>
</head>

<body>
	<div>
		<canvas id="canvas" width="200" height="200"></canvas>
		<div id="svg"></div>
	</div>
	<form id="inputcontrols" action="#">
		<div>
			<textarea id="data_area">2:7:8:26:20:45:27:53:41
2:7:8:11:66:32:73:39:87
2:7:8:13:133:39:142:36:184
2:32:7:33:150:36:138:68:67
1:0:0:63:34:189:34
1:0:0:104:13:104:53
1:0:0:147:13:147:53
1:12:13:83:63:83:92
1:2:2:83:63:168:63
1:22:23:168:63:168:92
1:2:2:83:92:168:92
1:0:0:73:114:178:114
1:0:0:64:137:187:137
7:32:7:126:63:126:114:126:177:48:187
2:7:0:129:137:146:172:180:182</textarea>
		</div>
		<div>
			<label><input type="radio" value="0" name="kagefont" checked>明朝</label>
			<label><input type="radio" value="1" name="kagefont">ゴシック</label><br>
			<label>kMinWidthY: <input type="number" min="0" step="0.1" id="kageparam_kMinWidthY" value="2"></label><br>
			<label>kMinWidthU: <input type="number" min="0" step="0.1" id="kageparam_kMinWidthU" value="2"></label><br>
			<label>kMinWidthT: <input type="number" min="0" step="0.1" id="kageparam_kMinWidthT" value="6"></label><br>
			<label>kWidth: <input type="number" min="0" step="0.1" id="kageparam_kWidth" value="5"></label><br>
			<label>kKakato: <input type="number" min="0" step="0.1" id="kageparam_kKakato" value="3"></label><br>
			<label>kL2RDfatten: <input type="number" min="0" step="0.1" id="kageparam_kL2RDfatten" value="1.1"></label><br>
			<label>kMage: <input type="number" min="0" step="0.1" id="kageparam_kMage" value="10"></label>
		</div>
	</form>
</body>

</html>
